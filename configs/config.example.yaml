# Open-UAV-Telemetry-Bridge Configuration
# Copy this file to config.yaml and modify as needed

server:
  log_level: info  # debug, info, warn, error
  log_buffer_size: 1000  # Number of log entries to keep in memory (for Web UI)

# MAVLink Adapter Configuration
mavlink:
  enabled: true
  connection_type: udp   # udp | tcp | serial
  address: "0.0.0.0:14550"
  # For serial connection:
  # connection_type: serial
  # serial_port: "/dev/ttyUSB0"
  # serial_baud: 57600

# DJI Forwarder Adapter Configuration
dji:
  enabled: false
  listen_address: "0.0.0.0:14560"  # TCP server for Android forwarder
  max_clients: 10                   # Maximum concurrent DJI forwarder connections

# MQTT Publisher Configuration
mqtt:
  enabled: true
  broker: "tcp://localhost:1883"
  client_id: "outb-001"
  topic_prefix: "uav/telemetry"
  qos: 1
  # username: ""
  # password: ""
  lwt:
    enabled: true
    topic: "uav/status"
    message: "offline"

# GB/T 28181 National Standard Publisher Configuration
gb28181:
  enabled: false
  device_id: "34020000001320000001"    # 20-digit device code
  device_name: "UAV-Gateway-001"       # Display name
  local_ip: "192.168.1.100"            # Local SIP address
  local_port: 5060                     # Local SIP port
  server_id: "34020000002000000001"    # Platform SIP server ID
  server_ip: "192.168.1.1"             # Platform SIP server IP
  server_port: 5060                    # Platform SIP port
  server_domain: "3402000000"          # SIP domain (first 10 digits of server_id)
  username: "34020000001320000001"     # SIP auth username (usually same as device_id)
  password: "password123"              # SIP auth password
  transport: udp                       # udp | tcp
  register_expires: 3600               # REGISTER expiry in seconds
  heartbeat_interval: 60               # Keepalive interval in seconds
  position_interval: 5                 # Position report interval in seconds

# HTTP API Configuration
http:
  enabled: true
  address: "0.0.0.0:8080"
  cors_enabled: true
  cors_origins: ["http://localhost:3000"]  # Restrict to specific origins in production
  webui_enabled: true  # Enable embedded Web UI
  # TLS/HTTPS Configuration
  tls:
    enabled: false       # Enable HTTPS
    cert_file: ""        # Path to TLS certificate (e.g., "/etc/ssl/certs/server.crt")
    key_file: ""         # Path to TLS private key (e.g., "/etc/ssl/private/server.key")
  # Rate Limiting Configuration
  rate_limit:
    enabled: true        # Enable rate limiting
    requests_per_sec: 100  # Maximum requests per second per IP
    burst_size: 200      # Maximum burst size
  # Authentication Configuration
  auth:
    enabled: false       # Enable JWT authentication
    username: "admin"    # Admin username
    # Password hash (bcrypt) - generate with: htpasswd -nbBC 10 "" password | tr -d ':'
    # Default: "admin123" -> "$2a$10$..."
    password_hash: ""
    jwt_secret: ""       # Secret key for JWT signing (required when auth enabled)
    token_expiry_hours: 24

# Frequency Throttling Configuration
throttle:
  default_rate_hz: 1.0   # Normal reporting rate
  min_rate_hz: 0.5       # Minimum rate during idle
  max_rate_hz: 10.0      # Maximum rate during alerts

# Coordinate Conversion Configuration (for China maps)
coordinate:
  convert_gcj02: true    # Convert to GCJ02 (Amap, Tencent, Google China)
  convert_bd09: false    # Convert to BD09 (Baidu Maps)

# Track Storage Configuration (historical trajectory)
track:
  enabled: true
  max_points_per_drone: 10000  # Maximum track points per drone
  sample_interval_ms: 1000     # Minimum sampling interval in milliseconds
